---
  title: "TDA - Time Series"
output:
  html_document: default
word_document: default
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Libraries
```{r}
library(caret)
library(lattice)
library(ggplot2)
library(dplyr)
library(ellipsis)
library(deSolve)
library(data.table)
```

#Stable Equilibrium - Time series
```{r}
Time_Series_Data<- data.frame()

for (i in 1:200){
  parameters1 <- c(b = 7.48, c_ea = 0.009, c_pa = 0.004, c_el = 0.012, u_p = 0, u_l = 0.267, u_a = 0.73)

  state1 <- c(L = sample(2:100,1), P = sample(2:100,1), A = sample(2:100,1))
  
  #ODE's that model Beetles
  beetles1<-function(t, state, parameters) {
    with(as.list(c(state, parameters)),{
      # rate of change
      L1 <- b * A * exp((-c_el * L) - (c_ea * A))
      P1 <- L * (1 - u_l) 
      A1 <- (P * exp(-c_pa * A) + A * (1 - u_a)) 
      
      # return the rate of change
      list(c(L1, P1, A1))
    }) # end with(as.list ...
  }

  #Plotting A vs Time Graph
  
  Stable_i <- ode(y = state1, times = seq(0, 200), func = beetles1, parms = parameters1, method = "iteration")
  
#Time_Series_Stable1 <- rbind.data.frame(Time_Series_Stable,Time_Series_Stable1)
stable <- as.data.frame(Stable_i) %>% select(A)
transposeStable<-t(stable)
Time_Series_Data <- rbind.data.frame(transposeStable,Time_Series_Data)
}
```

#Aperiodic 
```{r}
for (i in 1:200){
  parameters2 <- c(b = 7.48, c_ea = 0.009, c_pa = 0.004, c_el = 0.012, u_p = 0, u_l = 0.267, u_a = 0.96)
  state2 <- c(L = sample(2:100,1), P = sample(2:100,1), A = sample(2:100,1))
  beetles2<-function(t, state, parameters) {
    with(as.list(c(state, parameters)),{
      # rate of change
      L1 <- b * A * exp((-c_el * L) - (c_ea * A))
      P1 <- L * (1 - u_l) 
      A1 <- (P * exp(-c_pa * A) + A * (1 - u_a)) 
      
      # return the rate of change
      list(c(L1, P1, A1))
    }) # end with(as.list ...
  }
  
times2 <- seq(0, 200)
Aperiodic_i <- ode(y = state2, times = times2, func = beetles2, parms = parameters2, method = "iteration")
  

aperiodic <- as.data.frame(Aperiodic_i) %>% select(A)
transposeAperiodic<-t(aperiodic)
Time_Series_Data <- rbind.data.frame(transposeAperiodic,Time_Series_Data)
  
}
```

#Rename rows so we can Identify Time series as Stable or Aperiodic
```{r}
(setattr(Time_Series_Data, "row.names", c(rep("Aperiodic",200),rep("Stable",200))))
```

#Turning Atomic Vector into dataframe for manipulation
```{r}
#Time_Series_Stable1$Classification =c(rep("Stable"))

#Time_Series_Aperiodic1$Classification =c(rep("Aperiodic"))

#ts <- rbind.data.frame(Time_Series_Stable1,Time_Series_Aperiodic1) %>%
 # select(time, A, Classification)
```

#ConfusionMatrix
```{r}
#kmtotal <- kmeans(ts$A, 2,100)
#km_clusters <- kmtotal$cluster
#correct <- rep(c("1","2"), each=603)
#table(km_clusters,correct)
```

#K-Means
```{r}
kmeans(Time_Series_Data, 2, iter.max = 10, nstart = 1)
```



